---
import type { HTMLAttributes } from "astro/types";
import Tooltip from "./Tooltip.astro";

type Props = {
    text: string;
    textToCopy?: string;
} & HTMLAttributes<"button">;

const { text, textToCopy = text, ...props } = Astro.props;
---

<Tooltip label="Copy to clipboard" data-clipboard-text={textToCopy} {...props}>
    {text}
</Tooltip>

<script>
    import { computePosition } from "@floating-ui/dom";

    document.querySelectorAll<HTMLButtonElement>("button[data-clipboard-text]").forEach((button) => {
        button.addEventListener("click", async () => {
            try {
                await navigator.clipboard.writeText(button.innerText);

                const popover = document.getElementById(button.getAttribute("popovertarget")!);

                if (!popover) {
                    return;
                }

                popover.innerText = "Copied!";

                const { x, y } = await computePosition(button, popover);

                Object.assign(popover.style, {
                    top: `${y}px`,
                    left: `${x}px`,
                });
            } catch (error) {
                console.error(error);
            }
        });
    });
</script>
