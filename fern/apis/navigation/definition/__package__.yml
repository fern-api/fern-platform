# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

types:
  Slug: string
  Url: string

  VersionId: string
  TabId: string
  PageId: string
  NodeId: string

  ApiDefinitionId: string
  EndpointId: string
  WebSocketId: string
  WebhookId: string

  # discriminated unions

  RootChild:
    discriminated: false
    union:
      - VersionedNode
      - UnversionedNode

  VersionChild:
    discriminated: false
    union:
      - TabbedNode
      - SidebarRootNode

  TabChild:
    discriminated: false
    union:
      - TabNode
      - LinkNode
      - ChangelogNode

  SidebarRootChild:
    discriminated: false
    union:
      - SidebarGroupNode
      - ApiReferenceNode
      - SectionNode

  NavigationChild:
    discriminated: false
    union:
      - ApiReferenceNode
      - SectionNode
      - PageNode
      - LinkNode
      - ChangelogNode

  ApiPackageChild:
    discriminated: false
    union:
      - ApiPackageNode
      - EndpointNode
      - EndpointPairNode
      - WebSocketNode
      - WebhookNode
      - PageNode
      - LinkNode

  # nodes without metadata

  VersionedNode:
    extends: WithNodeId
    properties:
      type: literal<"versioned">
      children: list<VersionNode>

  UnversionedNode:
    extends: WithNodeId
    properties:
      type: literal<"unversioned">
      child: VersionChild
      landingPage: optional<LandingPageNode>

  TabbedNode:
    extends: WithNodeId
    properties:
      type: literal<"tabbed">
      children: list<TabChild>

  SidebarRootNode:
    extends: WithNodeId
    properties:
      type: literal<"sidebarRoot">
      children: list<SidebarRootChild>

  SidebarGroupNode:
    extends: WithNodeId
    properties:
      type: literal<"sidebarGroup">
      children: list<NavigationChild>

  EndpointPairNode:
    extends: WithNodeId
    properties:
      type: literal<"endpointPair">
      stream: EndpointNode
      nonStream: EndpointNode

  LinkNode:
    extends: WithNodeId
    properties:
      type: literal<"link">
      title: string
      icon: optional<string>
      url: Url

  # nodes with metadata

  RootNode:
    extends:
      - WithNodeMetadata
      - WithRedirect
    properties:
      type: literal<"root">
      version: literal<"v1">
      child: RootChild

  VersionNode:
    extends:
      - WithNodeMetadata
      - WithRedirect
    properties:
      type: literal<"version">
      default: boolean
      versionId: VersionId
      child: VersionChild
      availability: optional<Availability>
      landingPage: optional<LandingPageNode>

  TabNode:
    extends:
      - WithNodeMetadata
      - WithRedirect
    properties:
      type: literal<"tab">
      child: SidebarRootNode

  PageNode:
    extends: WithNodeMetadata
    properties:
      type: literal<"page">
      pageId: PageId

  LandingPageNode:
    extends: WithNodeMetadata
    properties:
      type: literal<"landingPage">
      pageId: PageId

  SectionNode:
    extends:
      - WithNodeMetadata
      - WithOverviewPage
      - WithRedirect
    properties:
      type: literal<"section">
      collapsed: optional<boolean>
      children: list<NavigationChild>

  ChangelogNode:
    extends:
      - WithNodeMetadata
      - WithOverviewPage
    properties:
      type: literal<"changelog">
      children: list<ChangelogYearNode>

  ChangelogYearNode:
    extends: WithNodeMetadata
    properties:
      type: literal<"changelogYear">
      year: integer
      children: list<ChangelogMonthNode>

  ChangelogMonthNode:
    extends: WithNodeMetadata
    properties:
      type: literal<"changelogMonth">
      month: integer
      children: list<ChangelogEntryNode>

  ChangelogEntryNode:
    extends: WithNodeMetadata
    properties:
      type: literal<"changelogEntry">
      pageId: PageId
      date: date

  ApiReferenceNode:
    extends:
      - WithNodeMetadata
      - WithOverviewPage
      - WithApiDefinitionId
      - WithRedirect
    properties:
      type: literal<"apiReference">
      disableLongScrolling: optional<boolean>
      showErrors: optional<boolean>
      hideTitle: optional<boolean>
      children: list<ApiPackageChild>
      changelog: optional<ChangelogNode>

  EndpointNode:
    extends:
      - WithNodeMetadata
      - WithApiDefinitionId
    properties:
      type: literal<"endpoint">
      method: HttpMethod
      endpointId: EndpointId
      isResponseStream: optional<boolean>

  WebSocketNode:
    extends:
      - WithNodeMetadata
      - WithApiDefinitionId
    properties:
      type: literal<"webSocket">
      webSocketId: WebSocketId

  WebhookNode:
    extends:
      - WithNodeMetadata
      - WithApiDefinitionId
    properties:
      type: literal<"webhook">
      method: HttpMethod
      webhookId: WebhookId

  ApiPackageNode:
    extends:
      - WithNodeMetadata
      - WithOverviewPage
      - WithApiDefinitionId
      - WithRedirect
    properties:
      type: literal<"apiPackage">
      children: list<ApiPackageChild>

  # utilities

  WithNodeId:
    properties:
      id:
        type: NodeId
        docs: A unique, stable identifier for this node.

  WithNodeMetadata:
    extends: WithNodeId
    properties:
      title: string
      slug: Slug
      icon: optional<string>
      hidden: optional<boolean>

  WithOverviewPage:
    properties:
      overviewPageId: optional<PageId>

  WithApiDefinitionId:
    properties:
      apiDefinitionId: ApiDefinitionId
      availability: optional<Availability>

  WithRedirect:
    properties:
      pointsTo: optional<Slug>

  # enums

  HttpMethod:
    enum:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE

  Availability:
    enum:
      - stable
      - name: GenerallyAvailable
        value: generally-available
      - name: InDevelopment
        value: in-development
      - name: PreRelease
        value: pre-release
      - beta
      - deprecated
