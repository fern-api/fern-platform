# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  rootCommons: ../../commons.yml
  navigation: ../../navigation/latest/__package__.yml
  algolia: ../../algolia.yml
  v1Commons: ../v1/commons/commons.yml
  v1DocsWrite: ../v1/write/__package__.yml

service:
  base-path: /v3/registry/docs
  auth: true
  endpoints:
    getOrganization:
      method: GET
      path: /{domain}/organization
      path-parameters:
        domain: string
      response: rootCommons.OrgId
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.NotFoundError

    getNavigation:
      method: GET
      path: /{domain}/instance/{id}/navigation
      path-parameters:
        domain: string
        id: DocsInstanceId
      response: navigation.RootNode
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.NotFoundError

    getConfig:
      method: GET
      path: /{domain}/instance/{id}/config
      path-parameters:
        domain: string
        id: DocsInstanceId
      response: DocsConfig
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.NotFoundError

    getPages:
      method: POST
      path: /{domain}/instance/{id}/pages
      path-parameters:
        domain: string
        id: DocsInstanceId
      request:
        name: BulkGetPagesRequest
        body:
          properties:
            pages: list<rootCommons.PageId>
      response: map<rootCommons.PageId, PageContent>
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.NotFoundError

    getFiles:
      method: POST
      path: /{domain}/instance/{id}/files
      path-parameters:
        domain: string
        id: DocsInstanceId
      request:
        name: BulkGetFilesRequest
        body:
          properties:
            files: list<rootCommons.FileId>
      response: map<rootCommons.FileId, FileMetadata>
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.NotFoundError

    startDocsPreview:
      method: POST
      path: /register/{organization}/preview
      path-parameters:
        organization: rootCommons.OrgId
      request:
        name: StartDocsPreviewRequest
        body:
          properties:
            filepaths: list<string>
      response:
        name: StartDocsPreviewResponse
        body:
          properties:
            docsRegistrationId: v1DocsWrite.DocsRegistrationId
            uploadUrl: rootCommons.Url
            previewUrl: rootCommons.Url
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.UnavailableError

    startDocsRegister:
      method: POST
      path: /register/{organization}/init/{domain}
      path-parameters:
        organization: rootCommons.OrgId
        domain: string
      request:
        name: StartDocsRegisterRequest
        body:
          properties:
            aliases: list<string>
            filepaths: list<string>
            # authConfig: optional<rootCommons.AuthConfig>
            # filepaths: list<string>
            # images: optional<list<string>>
      response:
        name: StartDocsRegisterResponse
        body:
          properties:
            docsRegistrationId: v1DocsWrite.DocsRegistrationId
            uploadUrl: rootCommons.Url
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.UnavailableError

    putDocsMetadata:
      method: PUT
      path: /register/{organization}/job/{docsRegistrationId}/metadata
      path-parameters:
        domain: string
        docsRegistrationId: v1DocsWrite.DocsRegistrationId
      request:
        name: PutDocsMetadata
        body:
          properties:
            config: DocsConfig
            navigation: navigation.RootNode
      errors:
        - rootCommons.UnauthorizedError
        - rootCommons.UnavailableError

    putDocsPages:
      method: PUT
      path:

types:
  DocsInstanceId:
    discriminated: false
    union:
      - rootCommons.DocsConfigId
      - literal<"latest">

  FileMetadata:
    union:
      url: UrlFile
      image: ImageFile

  UrlFile:
    properties:
      url: rootCommons.Url

  ImageFile:
    properties:
      url: rootCommons.Url
      width: double
      height: double
      blurDataUrl: optional<string>
      alt: optional<string>

  PageContent:
    properties:
      markdown: string
      editThisPageUrl: optional<rootCommons.Url>

  DocsConfig:
    properties:
      id: rootCommons.DocsConfigId
      updatedAt: datetime

      title: optional<string>
      defaultLanguage: optional<v1Commons.ProgrammingLanguage>
      announcement: optional<v1Commons.AnnouncementConfig>

      # navigation
      navbarLinks: optional<list<v1Commons.NavbarLink>>
      footerLinks: optional<list<v1Commons.FooterLink>>

      # logo
      logoHeight: optional<double>
      logoHref: optional<rootCommons.Url>
      favicon: optional<rootCommons.FileId>

      # seo
      metadata: optional<v1Commons.MetadataConfig>
      redirects: optional<list<v1Commons.RedirectConfig>>

      # styles
      colors: optional<ColorsConfig>
      fonts: optional<v1Commons.DocsTypographyConfigV2>
      layout: optional<v1Commons.DocsLayoutConfig>

      # integrations
      analytics: optional<v1Commons.AnalyticsConfig>
      integrations: optional<v1Commons.IntegrationsConfig>
      search: optional<algolia.SingleAlgoliaIndexInfo>

      # css and js
      css: optional<v1Commons.CssConfig>
      js: optional<v1Commons.JsConfig>

      # playground
      playground: optional<v1Commons.PlaygroundConfig>

      # files
      files: optional<list<rootCommons.FileId>>
      markdownPageIds: optional<list<rootCommons.PageId>>
      mdxBundlerFileIds: optional<list<rootCommons.PageId>>

  ColorsConfig:
    properties:
      dark: optional<ThemeConfig>
      light: optional<ThemeConfig>

  ThemeConfig:
    properties:
      logo: optional<rootCommons.FileId>
      backgroundImage: optional<rootCommons.FileId>
      accentPrimary: rootCommons.RgbaColor
      background: Background
      border: optional<rootCommons.RgbaColor>
      sidebarBackground: optional<rootCommons.RgbaColor>
      headerBackground: optional<rootCommons.RgbaColor>
      cardBackground: optional<rootCommons.RgbaColor>

  Background:
    union:
      solid: rootCommons.RgbaColor
      gradient: {}

  GetSearchKeyResponse:
    properties:
      key: string
