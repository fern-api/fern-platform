imports:
  commons: commons.yml
  snippets: __package__.yml

service:
  auth: true
  base-path: /snippet-template
  endpoints:
    register:
      path: /register
      docs: Store endpoint snippet for a particular SDK.
      display-name: Store snippet
      method: POST
      request:
        name: RegisterSnippetTemplateRequest
        body:
          properties:
            orgId:
              type: commons.OrgId
              docs: |
                The organization to create snippets for.
            apiId:
              type: commons.ApiId
              docs: |
                The API name.
            snippet: SnippetRegistryEntry

    registerBatch:
      path: /register/batch
      docs: Store endpoint snippets for a particular SDK.
      display-name: Store snippets
      method: POST
      request:
        name: RegisterSnippetTemplateBatchRequest
        body:
          properties:
            orgId:
              type: commons.OrgId
              docs: |
                The organization to create snippets for.
            apiId:
              type: commons.ApiId
              docs: |
                The API name.
            snippets: list<SnippetRegistryEntry>

    get:
      path: /get
      docs: Get the endpoint's snippet template for a particular SDK.
      display-name: Store snippets
      method: POST
      errors:
        - commons.UnauthorizedError
        - SnippetNotFound
      request:
        name: GetSnippetTemplate
        body:
          properties:
            orgId:
              type: commons.OrgId
              docs: |
                The organization to create snippets for.
            apiId:
              type: commons.ApiId
              docs: |
                The API name.
            sdk: snippets.SDK
            endpointId: snippets.EndpointIdentifier
      response: EndpointSnippetTemplate

types:
  # Internal Snippet structure
  TemplateSentinel: literal<"$FERN_INPUT">

  DiscriminatedUnionTemplate:
    properties:
      members: map<string, Template>
  EnumTemplate:
    properties:
      template: optional<string>
      values: map<string, string>
  GenericTemplate:
    properties:
      template: string
  DictTemplate:
    properties:
      containerTemplate:
        type: string
        docs: Commonly the braces of a container like `{ $FERN_INPUT }`, but may even be something like `new Dict( $FERN_INPUT )`
      delimiter: string
      keyTemplate: Template
      valueTemplate: Template
  IterableTemplate:
    properties:
      containerTemplate:
        type: string
        docs: Commonly the braces of a container like `[ $FERN_INPUT ]` for a list or `{ $FERN_INPUT }` for a set
      delimiter: string
      innerTemplate:
        type: Template
        docs: |
          In the event of an array, the root template would be something like `[ fern!{{ child }} ]`
          and so the child would be the actual object type seen in the example.
  Template:
    base-properties:
      imports: optional<list<string>>
      templateInputs:
        type: optional<list<TemplateInput>>
        docs: An ordered list of inputs to the template.
      inputDelimiter: optional<string>
      isOptional:
        type: boolean
        docs: |
          We might not need this, but the idea here is to be able to omit if it's optional and undefined,
          or default if omitted and required.
    union:
      generic: GenericTemplate
      enum: EnumTemplate
      discriminatedUnion: DiscriminatedUnionTemplate
      dict: DictTemplate
      iterable: IterableTemplate

  TemplateInput:
    discriminated: false
    union:
      - Template
      - PayloadInput
  PayloadLocation:
    docs: |
      The location of the payload, if omitted the full payload is used.
      Note that RELATIVE should be used for iterables primarily, so be
      able to specify the path to the field relative to the iterated on object
    enum:
      - BODY
      - QUERY
      - PATH
      - HEADERS
      - RELATIVE
  PayloadInput:
    properties:
      location: PayloadLocation
      path:
        type: optional<string>
        docs: Dot delimited path to the value within the payload, if omitted the full payload is used.

  SnippetTemplate:
    properties:
      clientInstantiation: Template
      functionInvocation: Template
  VersionedSnippetTemplate:
    union:
      v1: SnippetTemplate

  SnippetRegistryEntry:
    properties:
      orgId: commons.OrgId
      apiId: commons.ApiId
      sdk: snippets.SDK
      endpointId: snippets.EndpointIdentifier
      snippetTemplate: VersionedSnippetTemplate

  EndpointSnippetTemplate:
    properties:
      sdk: snippets.SDK
      endpointId: snippets.EndpointIdentifier
      snippetTemplate: VersionedSnippetTemplate

errors:
  SnippetNotFound:
    status-code: 404
    docs: The requested snippet was not found
    type: string
