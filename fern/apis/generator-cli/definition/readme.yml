# TODO: We might want to just add in the necessary information to generator-exec
# and reuse that. This otherwise might get too complicated.
#
# However, it isn't great to include a bunch of information in the generator config
# that wouldn't be read by any generator.
#
# We'll use this for development purposes to keep things separate.

imports:
  features: features.yml
types:
  EndpointId:
    docs: |
      A unique identifier for an endpoint. This is interchangeable with the
      identifier used between the IR and the snippets API.
    type: string

  ReadmeConfig:
    docs: |
      The configuration specified by the user.
    properties:
      language: string
      organization: string
      publishInfo: optional<PublishInfo>
      bannerLink: optional<string>
      docsLink: optional<string>
      featureEndpoints:
        docs: |
          The list of endpoints associated with a particular feature.
          The README.md will include each of the associated snippets
          written by the generator.
        type: optional<map<features.FeatureId, list<EndpointId>>>

  PublishInfo:
    docs: |
      A separate, simpler representation of the publish information
      found in the generator-exec configuration. This is used to
      generate README.md badges.
    union:
      npm: NpmPublishInfo
      pypi: PypiPublishInfo
      go: GoPublishInfo
      maven: MavenPublishInfo

  NpmPublishInfo:
    properties:
      packageName: string

  PypiPublishInfo:
    properties:
      packageName: string

  GoPublishInfo:
    properties:
      owner: string
      repo: string
      version: string

  MavenPublishInfo:
    properties:
      artifact: string
      group: string
      version: string

service:
  auth: true
  base-path: /readme
  endpoints:
    generate:
      path: /generate
      docs: Generates a README.md using the provided configuration.
      display-name: Generate README.md
      method: POST
      availability: pre-release
      audiences:
        - external
        - fiddle
      request:
        name: GenerateReadmeRequest
        body:
          properties:
            # TODO: If we store the features.yml data in the DB, we can
            # alternatively accept the generator name and version.
            featuresConfig: features.FeaturesConfig
            readmeConfig: ReadmeConfig
            snippets:
              # TODO: This is duplicative; FDR already stores snippets, so
              # we shouldn't need to pass them here. However, FDR doesn't
              # store the snippets based on their feature, so we'd need
              # to remodel the FDR API to do so.
              docs: |
                The snippet.json produced by the generator.
              type: unknown
            originalReadme: optional<string>
      response: string
